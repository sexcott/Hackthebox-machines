La estructura de nuestro informe variará ligeramente dependiendo de la evaluación que se nos encomiende realizar. En este módulo, nos centraremos principalmente en un informe de prueba de penetración interna en el que el evaluador logró comprometer el dominio de Active Directory (AD) durante una prueba de penetración interna. El informe con el que trabajaremos demostrará los elementos típicos de un informe de prueba de penetración interna. Discutiremos aspectos de otros informes (como apéndices adicionales que pueden incluirse en un informe de Prueba de penetración externa). No es raro ver un informe de prueba de penetración externa que resultó en un compromiso interno con una cadena de ataque y otros elementos que cubriremos. La principal diferencia en nuestro laboratorio es que no incluiremos datos OSINT/información disponible públicamente, como direcciones de correo electrónico, subdominios, credenciales en volcados de incumplimiento, datos de propiedad/registro de dominio, etc., porque no estamos realizando pruebas con una empresa real con una Presencia en Internet. Si bien hay algunos jugadores veteranos que tienen poder de permanencia, como Have I Been Pwned, Shodan e Intelx, las herramientas OSINT también son generalmente muy fluidas, por lo que para cuando se publique este curso, es posible que la mejor herramienta o recurso para recopilar esa información haya cambiado. . En su lugar, enumeramos algunos tipos comunes de información destinada a ayudar en una prueba de penetración y dejamos que el lector pruebe y descubra qué herramientas o API brindan los mejores resultados. Siempre es una buena idea no depender de ninguna herramienta, así que ejecute varias y vea cuál es la diferencia en los datos.

- DNS público y registros de propiedad de dominio
- Correos electrónicos
    - Luego puede usarlos para verificar si alguno ha estado involucrado en una infracción o usar Google Dorks para buscarlos en sitios como Pastebin.
- Subdominios
- Proveedores externos
- Dominios similares
- Recursos de la nube pública

Estos tipos de recopilación de información se tratan en otros módulos, como [Recopilación de información - Edición web](https://academy.hackthebox.com/course/preview/information-gathering---web-edition) , [OSINT: Corporate Recon](https://academy.hackthebox.com/course/preview/osint-corporate-recon) y [Footprinting](https://academy.hackthebox.com/course/preview/footprinting) , y están fuera del alcance de este módulo.

## Diferencias entre tipos de evaluación

Antes de analizar los distintos tipos de informes disponibles y luego profundizar en los componentes de un informe de prueba de penetración, definamos algunos tipos de evaluación clave.

#### Evaluación de vulnerabilidad

Las evaluaciones de vulnerabilidad implican ejecutar un análisis automatizado de un entorno para enumerar las vulnerabilidades. Estos pueden estar autenticados o no autenticados. No se intenta ninguna explotación, pero a menudo buscamos validar los resultados del escáner para que nuestro informe pueda mostrarle al cliente qué resultados del escáner son problemas reales y cuáles son falsos positivos. La validación puede consistir en realizar una verificación adicional para confirmar que se está utilizando una versión vulnerable o que existe una configuración/configuración incorrecta, pero el objetivo no es ganar terreno y moverse lateralmente/verticalmente. Algunos clientes incluso solicitarán resultados del escaneo sin validación.

#### Interno versus externo

Se realiza un escaneo externo desde la perspectiva de un usuario anónimo en Internet dirigido a los sistemas públicos de la organización. Un análisis interno se realiza desde la perspectiva de un escáner en la red interna e investiga los hosts detrás del firewall. Esto se puede hacer desde la perspectiva de un usuario anónimo en la red de usuarios corporativos, emulando un servidor comprometido o cualquier cantidad de escenarios diferentes. Un cliente puede incluso solicitar que se realice un escaneo interno con credenciales, lo que puede generar muchos más hallazgos del escáner que analizar, pero también producirá resultados más precisos y menos genéricos.
#### Contenido del informe

Estos informes generalmente se centran en temas que se pueden observar en los resultados del análisis y resaltan la cantidad de vulnerabilidades y sus niveles de gravedad. Estos escaneos pueden producir MUCHOS datos, por lo que identificar patrones y relacionarlos con deficiencias de procedimiento es importante para evitar que la información se vuelva abrumadora.

## Pruebas de penetración

Las pruebas de penetración van más allá de los análisis automatizados y pueden aprovechar los datos del análisis de vulnerabilidades para ayudar a guiar la explotación. Al igual que los análisis de vulnerabilidades, estos se pueden realizar desde una perspectiva interna o externa. Dependiendo del tipo de prueba de penetración (es decir, una prueba evasiva), es posible que no realicemos ningún tipo de escaneo de vulnerabilidades.

Una prueba de penetración se puede realizar desde varias perspectivas, como " `black box`" donde no tenemos más información que el nombre de la empresa durante una conexión externa o de red para una interna " " `grey box`donde solo se nos dan direcciones IP dentro del alcance. /Rangos de red CIDR, o " `white box`" donde se nos pueden dar credenciales, código fuente, configuraciones y más. Se pueden realizar pruebas `zero evasion`para intentar descubrir tantas vulnerabilidades como sea posible, desde un `hybrid evasive`punto de vista de probar las defensas del cliente comenzando de manera evasiva y gradualmente volviéndose "más ruidoso" para ver en qué nivel los equipos de seguridad internos/herramientas de monitoreo nos detectan y bloquean. Normalmente, una vez que nos detectan en este tipo de evaluación, el cliente nos pedirá que pasemos a pruebas no evasivas durante el resto de la evaluación. Este es un excelente tipo de evaluación para recomendar a clientes que tienen algunas defensas implementadas pero que no tienen una postura de seguridad defensiva muy madura. Puede ayudar a mostrar las lagunas en sus defensas y dónde deberían concentrar esfuerzos para mejorar sus reglas de detección y prevención. Para clientes más maduros, este tipo de evaluación puede ser una gran prueba de sus defensas y procedimientos internos para garantizar que todas las partes desempeñen sus funciones adecuadamente en caso de un ataque real.

Finalmente, es posible que se nos pida que actuemos `evasive testing`durante toda la evaluación. En este tipo de evaluación, intentaremos pasar desapercibidos el mayor tiempo posible y ver qué tipo de acceso, si es que hay alguno, podemos obtener mientras trabajamos de forma sigilosa. Esto puede ayudar a simular un atacante más avanzado. Sin embargo, este tipo de evaluación suele estar limitada por limitaciones de tiempo que no existen para un atacante del mundo real. Un cliente también puede optar por una simulación de adversario a más largo plazo que puede ocurrir durante varios meses, con pocos empleados de la empresa conscientes de la evaluación y pocos o ningún personal del cliente sabiendo el día/hora exacta de inicio de la evaluación. Este tipo de evaluación es adecuado para organizaciones más maduras en materia de seguridad y requiere un conjunto de habilidades un poco diferente al de un probador de penetración de redes/aplicaciones tradicional.

#### Interno versus externo

De manera similar a las perspectivas de escaneo de vulnerabilidades, las pruebas de penetración externa generalmente se realizarán desde la perspectiva de un atacante anónimo en Internet. Puede aprovechar los datos OSINT/información disponible públicamente para intentar obtener acceso a datos confidenciales a través de aplicaciones o la red interna atacando hosts conectados a Internet. Las pruebas de penetración internas se pueden realizar como usuario anónimo en la red interna o como usuario autenticado. Por lo general, se lleva a cabo para encontrar tantas fallas como sea posible para obtener un punto de apoyo, realizar una escalada de privilegios horizontal y vertical, moverse lateralmente y comprometer la red interna (generalmente el entorno Active Directory del cliente).

## Evaluaciones interdisciplinarias

Algunas evaluaciones pueden requerir la participación de personas con diversas habilidades que se complementan entre sí. Si bien logísticamente son más complejos, estos tienden a ser orgánicamente de naturaleza más colaborativa entre el equipo de consultoría y el cliente, lo que agrega un valor tremendo a la evaluación y la confianza en la relación. Algunos ejemplos de este tipo de evaluaciones incluyen:

#### Evaluaciones de estilo de equipo morado

Como su nombre lo indica, este es un esfuerzo combinado entre los equipos azul y rojo, más comúnmente un probador de penetración y un respondedor de incidentes. El concepto general es que el probador de penetración simula una amenaza determinada y el respondedor de incidentes trabaja con el equipo azul interno para revisar su conjunto de herramientas existente y determinar si las alertas están configuradas correctamente o si se necesitan ajustes para permitir una identificación correcta.
#### Pruebas de penetración centradas en la nube

Si bien se superpone en gran medida con una prueba de penetración convencional, una evaluación centrada en la nube se beneficiará del conocimiento de alguien con experiencia en arquitectura y administración de la nube. A menudo puede ser tan simple como ayudar a explicarle al evaluador de penetración qué es posible abusar de una información particular que se descubrió (como secretos o claves de algún tipo). Obviamente, cuando se empieza a introducir una infraestructura menos convencional, como contenedores y aplicaciones sin servidor, el enfoque para probar esos recursos requiere conocimientos muy específicos, probablemente una metodología y un conjunto de herramientas completamente diferentes. Como los informes para este tipo de evaluaciones son relativamente similares a las pruebas de penetración convencionales, se mencionan en este contexto para generar conciencia, pero los detalles técnicos sobre las pruebas de estos recursos únicos están fuera del alcance de este curso.

#### Pruebas integrales de IoT

Las plataformas de IoT suelen tener tres componentes principales: red, nube y aplicación. Hay personas muy especializadas en cada uno de estos que podrán brindar una evaluación mucho más exhaustiva en conjunto en lugar de depender de una persona con solo conocimientos básicos en cada área. Otro componente que quizás deba probarse es la capa de hardware, que se trata a continuación. De manera similar a las pruebas en la nube, hay aspectos de estas pruebas que probablemente requerirán un conjunto de habilidades especializadas fuera del alcance de este curso, pero el diseño estándar del informe de pruebas de penetración aún se presta bien para presentar este tipo de datos.

## Pruebas de penetración de aplicaciones web

Dependiendo del alcance, este tipo de evaluación también puede considerarse una evaluación interdisciplinaria. Es posible que algunas evaluaciones de aplicaciones solo se centren en identificar y validar las vulnerabilidades en una aplicación con pruebas autenticadas y basadas en roles, sin interés en evaluar el servidor subyacente. Otros pueden querer probar tanto la aplicación como la infraestructura con la intención de que el compromiso inicial sea a través de la propia aplicación web (nuevamente, tal vez desde una perspectiva autenticada o basada en roles) y luego intentar ir más allá de la aplicación para ver qué otros hosts y Existen sistemas detrás de esto que pueden verse comprometidos. El último tipo de evaluación se beneficiaría de alguien con experiencia en desarrollo y pruebas de aplicaciones para un compromiso inicial y luego tal vez un probador de penetración centrado en la red para "vivir de la tierra" y moverse o escalar privilegios a través de Active Directory o algún otro medio más allá del aplicaciones en sí.

## Pruebas de penetración de hardware

Este tipo de prueba se realiza a menudo en dispositivos tipo IoT, pero se puede ampliar para probar la seguridad física de una computadora portátil enviada por el cliente o de un quiosco o cajero automático en el sitio. Cada cliente tendrá un nivel de comodidad diferente con la profundidad de las pruebas aquí, por lo que es vital establecer las reglas de participación antes de que comience la evaluación, particularmente cuando se trata de pruebas destructivas. Si el cliente espera que su dispositivo vuelva a estar completo y funcionando, probablemente no sea aconsejable intentar desoldar chips de la placa base o realizar ataques similares.

## Reporte borrador

Cada vez es más común que los clientes esperen tener un diálogo e incorporar sus comentarios en un informe. Esto puede presentarse de muchas formas, ya sea que quieran agregar comentarios sobre cómo planean abordar cada hallazgo (respuesta de la administración), modificar un lenguaje potencialmente provocativo o mover las cosas hacia donde se adapte mejor a sus necesidades. Por estos motivos, es mejor planear enviar primero un borrador del informe, darle tiempo al cliente para revisarlo por su cuenta y luego ofrecerle un horario en el que pueda revisarlo con usted para hacer preguntas, obtener aclaraciones o explicar lo que necesita. Me gustaría ver. Al final, el cliente paga por el informe que se entrega y debemos asegurarnos de que sea lo más completo y valioso posible para él. Algunos no harán ningún comentario sobre el informe, mientras que otros solicitarán cambios o adiciones importantes para ayudarlo a satisfacer sus necesidades, ya sea para hacerlo presentable ante su junta directiva para obtener financiamiento adicional o utilizar el informe como aporte para sus hoja de ruta de seguridad para realizar remediaciones y fortalecer su postura de seguridad.

## Reporte final

Normalmente, después de revisar el informe con el cliente y confirmar que está satisfecho con él, se puede emitir el informe final con las modificaciones necesarias. Esto puede parecer un proceso frívolo, pero varias firmas de auditoría no aceptarán un borrador de informe para cumplir con sus obligaciones de cumplimiento, por lo que es importante desde la perspectiva del cliente.
#### Informe posterior a la remediación

También es común que un cliente solicite que los hallazgos que descubrió durante la evaluación original se vuelvan a probar después de haber tenido la oportunidad de corregirlos. Esto es casi necesario para las organizaciones que cumplen con un estándar de cumplimiento como PCI. No **debería** rehacer toda la evaluación para esta fase de la evaluación. Pero en lugar de ello, debería centrarse en volver a probar solo los hallazgos y solo los hosts afectados por esos hallazgos de la evaluación original. También desea asegurarse de que haya un límite de tiempo sobre cuánto tiempo después de la evaluación inicial realizamos pruebas de remediación. Estas son algunas de las cosas que podrían suceder si no lo hace.

- El cliente le pide que pruebe su solución varios meses o incluso un año o más después, y el entorno ha cambiado tanto que es imposible hacer una comparación "de manzanas con manzanas".
- Si verifica todo el entorno en busca de nuevos hosts afectados por un hallazgo determinado, puede descubrir nuevos hosts que estén afectados y caer en un ciclo interminable de pruebas de corrección de los nuevos hosts que descubrió la última vez.
- Si ejecuta nuevos análisis a gran escala, como análisis de vulnerabilidades, probablemente encontrará cosas que no estaban allí antes y su alcance se saldrá rápidamente de control.
- Si un cliente tiene un problema con la naturaleza de "instantánea" de este tipo de pruebas, podría recomendar una herramienta tipo simulación de ataques e infracciones (BAS) para ejecutar periódicamente esos escenarios y garantizar que no sigan apareciendo.
Si ocurre alguna de estas situaciones, debe esperar un mayor escrutinio en torno a los niveles de gravedad y tal vez presión para modificar cosas que no deberían modificarse para ayudarlos. En estas situaciones, su respuesta debe ser cuidadosamente elaborada para dejar claro que no va a cruzar límites éticos (pero tenga cuidado de no insinuar que le están pidiendo que haga algo intencionalmente deshonesto, indicando que son deshonestos), pero también compadecerse de su situación y ofrecerles algunas salidas. Por ejemplo, si su preocupación es tener que lidiar con un auditor para arreglar algo en un tiempo del que no tienen, es posible que no sepan que muchos auditores aceptarán un plan de remediación completamente documentado con una fecha límite razonable ( y justificación de por qué no puede completarse más rápidamente) en lugar de remediar y cerrar el hallazgo dentro del período de examen. Esto le permite mantener intacta su integridad, fomenta el sentimiento en el cliente de que usted se preocupa sinceramente por su situación y le brinda un camino a seguir sin tener que esforzarse para que esto suceda.

Un enfoque podría ser tratar esto como una nueva evaluación en estas situaciones. Si el cliente no está dispuesto, entonces probablemente querríamos volver a probar solo los hallazgos del informe original y anotar cuidadosamente en el informe el tiempo transcurrido desde la evaluación original, que se trata de una verificación puntual para evaluar si SÓLO las vulnerabilidades informadas anteriormente afectan al host o hosts informados originalmente y es probable que el entorno del cliente haya cambiado significativamente y no se haya realizado una nueva evaluación.

En términos de diseño del informe, algunas personas pueden preferir actualizar la evaluación original etiquetando los hosts afectados en cada hallazgo con un estado (por ejemplo, resuelto, no resuelto, parcial, etc.), mientras que otros pueden preferir emitir un nuevo informe completo que tenga contenido comparativo adicional y un resumen ejecutivo actualizado.

## Informe de atestación

Algunos clientes solicitarán un `Attestation Letter`o `Attestation Report`que sea adecuado para sus proveedores o clientes que requieran evidencia de que se les ha realizado una prueba de penetración. La diferencia más significativa es que su cliente no querrá entregar los detalles técnicos específicos de todos los hallazgos o credenciales u otra información secreta que pueda estar incluida a un tercero. Este documento se puede derivar del informe. Debería centrarse únicamente en la cantidad de hallazgos descubiertos, el enfoque adoptado y los comentarios generales sobre el medio ambiente mismo. Este documento probablemente sólo debería tener una o dos páginas.
## Otros entregables

#### Conjunto de diapositivas

También se le puede solicitar que prepare una presentación que se pueda realizar en varios niveles diferentes. Su audiencia puede ser técnica o más ejecutiva. El lenguaje y el enfoque deben ser tan diferentes en su presentación ejecutiva como lo es el resumen ejecutivo de los detalles de los hallazgos técnicos en su informe. Incluir únicamente gráficos y números hará que su audiencia se duerma, por lo que es mejor estar preparado con algunas anécdotas de su propia experiencia o tal vez algunos eventos actuales recientes que se correlacionen con un vector de ataque o compromiso específico. Puntos de bonificación si dicha historia pertenece a la misma industria que su cliente. El propósito de esto no es generar miedo y debes tener cuidado de no presentarlo de esa manera, pero ayudará a mantener la atención de tu audiencia. Hará que el riesgo sea lo suficientemente identificable como para maximizar sus posibilidades de hacer algo al respecto.

#### Hoja de cálculo de hallazgos

La hoja de cálculo de los hallazgos debería explicarse por sí sola. Estos son todos los campos en los resultados de su informe, solo en un diseño tabular que el cliente puede usar para clasificar más fácilmente y manipular otros datos. Esto también puede ayudarles a importar esos hallazgos a un sistema de emisión de tickets para fines de seguimiento interno. Este documento _no_ debe incluir su resumen ejecutivo o narrativas. Lo ideal es aprender a utilizar tablas dinámicas y utilizarlas para crear algunos análisis interesantes que el cliente pueda encontrar interesantes. El objetivo más útil al hacer esto es ordenar los hallazgos por gravedad o categoría para ayudar a priorizar la corrección.

---

## Notificaciones de vulnerabilidad

A veces, durante una evaluación, descubrimos una falla crítica que nos obliga a detener el trabajo e informar a nuestros clientes sobre un problema para que puedan decidir si desean emitir una solución de emergencia o esperar hasta que finalice la evaluación.

#### Cuándo redactar uno

Como mínimo, esto debe hacerse para `any`descubrir qué es lo `directly exploitable`que `exposed to the internet`da como resultado la ejecución remota de código no autenticado o la exposición de datos confidenciales, o aprovechar credenciales débiles o predeterminadas para lo mismo. Más allá de eso, se deben establecer expectativas al respecto durante el proceso de inicio del proyecto. Es posible que algunos clientes quieran que todos los hallazgos importantes y críticos se informen fuera de banda, independientemente de si son internos o externos. Algunas personas también pueden necesitar médiums. Por lo general, es mejor establecer una línea de base, decirle al cliente qué esperar y dejar que solicite modificaciones en el proceso si las necesita.

#### Contenido

Debido a la naturaleza de estas notificaciones, es importante limitar la cantidad de tonterías en estos documentos para que los técnicos puedan ir directamente a los detalles y comenzar a solucionar el problema. Por esta razón, probablemente sea mejor limitar esto al contenido típico que tiene en los detalles técnicos de sus hallazgos y proporcionar evidencia basada en herramientas para el hallazgo que el cliente pueda reproducir rápidamente si es necesario.
## Uniéndolo todo

Ahora que hemos cubierto los distintos tipos de evaluaciones y tipos de informes que se nos puede pedir que creemos para nuestros clientes, avancemos y hablemos sobre los componentes de un informe.